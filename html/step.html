<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set Light Spectrum</title>
    <!-- Link To CSS -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- Box Icons -->
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
</head>
<body id="step_page">
    <!-- Header -->
    <header>
        <div class="nav container">
            <!-- Menu Icon -->
            <div class="bulb-icon">
                <i class='bx bx-bulb' id="bulb-icon"></i>
            </div>
            <!-- Logo -->
            <div class = "log">
                <ul>
                    <li><a class="logo" id="logo">Intelligent Lighting Laboratory</a></li>
                </ul>
            </div>
        </div> 
    </header>

    <!-- Banner -->
    <section id="ovrflw" class="backgrd">
        <div class ="back">
            <a href="/metrics" class="back-btn"> Back </a> 
        </div>

        <div class = "vm">
            <h1 id="dateTime"></h1>
        </div>

        <div id="Steps" class = "Steps">
            <h1> Step Metrics</h1>

            <label for = "alloc_time" class="step_input_select_text"> Allocate Time: </label>
            <input type="text" name ="alloc_Time", id="alloc_time", class="step_input_time", placeholder="(minutes)"><br>
    
            <label for="metricsInput" class="step_input_select_text">Desired pairwise metrics: </label>
            <select id="metricsInput" name="metricsInput" class="step_input_select">
                <option value="-1">None</option>
                <option value="0">CCT & Photopic Lux</option>
                <option value="1">CCT & MEDI</option>
                <option value="2">Photopic Lux & MEDI</option>
                <option value="3">MEDI & MDER</option>
            </select><br>

            <div id="step_selected_pair1" style="display: none;">
                <!-- CCT -->
                <label for="step_get_cct" class="step_input_select_text">Desired initial CCT: </label>
                <input type="text" name ="step_get_cct", id="step_get_cct", class="step_input_text", placeholder="2000K ~ 6500K", min="2000", max="6500"><br>
                
                <!-- PLUX -->
                <label for="step_get_plux" name="step_get_plux" class="step_input_select_text">Desired initial Plux: </label>
                <input type="text" name ="step_get_plux", id="step_get_plux", class="step_input_text", placeholder="0lx ~ 250lx", min="0", max="250" >
                
                <div id='input-cct_step_cont'>
                    <!--Input container-->
                    <label class="step_input_select_text">Step CCT: </label>
                    <input class="input_Cp_step" id="input_Cp_step1">
                </div>

                <div id='input-plux_step_cont'>
                    <!--Input container-->
                    <label class="step_input_select_text"> Step Plux: </label>
                    <input class="input_cP_step" id="input_cP_step1">
                </div>

                <div id='input-time_step_cont'>
                    <!--Input container-->
                    <label class="step_input_select_text">Step Time (min): </label>
                    <input class="input_time_cp_step" id="input_time_cp_step1">
                </div>
            </div>
            <button id="add_step_cp_button" class="add_step_cp_button" onclick='addInputs_cp()'>+Add steps</button>
            <button id="set-step-button-cct-plux" class="set-step-button-cct-plux">Set</button> 


            <div id="step_selected_pair2" style="display: none;">
                <!-- CCT -->
                <label for="step_get_cct2" class="step_input_select_text">Desired initial CCT: </label>
                <input type="text" name ="step_get_cct2", id="step_get_cct2", class="step_input_text", placeholder="2000K ~ 6500K", min="2000", max="6500"><br>

                <!-- MEDI -->
                <label for="step_get_medi" class="step_input_select_text">Desired initial MEDI: </label>
                <input type="text" name ="step_get_medi", id="step_get_medi", class="step_input_text", placeholder="0lx ~ 200lx", min="0", max="200" >
            </div>
            
            <div id="step_selected_pair3" style="display: none;">
                <!-- PLUX -->
                <label for="step_get_plux2" class="step_input_select_text">Desired initial Plux: </label>
                <input type="text" name ="step_get_plux2", id="step_get_plux2", class="step_input_text", placeholder="0lux ~ 250lx", min="0", max="250"><br>

                <!-- MEDI -->
                <label for="step_get_medi2" class="step_input_select_text">Desired intial MEDI: </label>
                <input type="text" name ="step_get_medi2", id="step_get_medi2", class="step_input_text", placeholder="0lx ~ 200lx", min="0", max="200" >
            </div>
            
            <div id="step_selected_pair4" style="display: none;">
                <!-- MEDI -->
                <label for="step_get_medi3" class="step_input_select_text">Desired initial MEDI: </label>
                <input type="text" name ="step_get_medi3", id="step_get_medi3", class="step_input_text", placeholder="0lx ~ 200lx", min="0", max="200"><br>


                <!-- MDER -->
                <label for="step_get_mder" class="step_input_select_text">Desired intial Plux: </label>
                <input type="text" name ="step_get_mder", id="step_get_mder", class="step_input_text", placeholder="0 ~ 1", min="0", max="1" >
            </div>

           

       

        <script>
            //Input Constant
            const metricsInput = document.getElementById("metricsInput");
            const CCT_plux = document.getElementById("step_get_cct");
            const cct_PLUX = document.getElementById("step_get_plux");
            const CCT_medi = document.getElementById("step_get_cct2");
            const cct_MEDI = document.getElementById("step_get_medi");
            const PLUX_medi = document.getElementById("step_get_plux2");
            const plux_MEDI = document.getElementById("step_get_medi2");
            const MEDI_mder = document.getElementById("step_get_medi3");
            const medi_MDER = document.getElementById("step_get_mder");
            const allocate_Time = document.getElementById("alloc_time");

            // Select List Constant 
            const Stepbox = document.getElementById("Steps");
            const selectCCT_PLUX = document.getElementById("step_selected_pair1");
            const selectCCT_MEDI = document.getElementById("step_selected_pair2");
            const selectPLUX_MEDI = document.getElementById("step_selected_pair3");
            const selectMEDI_MDER = document.getElementById("step_selected_pair4");

            // Buttons
            const add_CP_step = document.getElementById("add_step_cp_button");
            const set_CP_step = document.getElementById("set-step-button-cct-plux");

            // CCT & Plux Step
            //CCT
            const step_CCT1 = document.getElementById("input_Cp_step1");
           
            //PLUX
            const step_PLUX1 = document.getElementById("input_cP_step1");
            
            //Time
            const step_time_CP1= document.getElementById("input_time_cp_step1");
            


            // Add  CCT and Plux function 
            var inputCount = 1;
            var inputCount_p = 1;
            var inputCount_tcp = 1;

            function addInputs_cp() {
                var containerCct = document.getElementById('input-cct_step_cont');
                var containerPlux = document.getElementById('input-plux_step_cont');
                var containerTime = document.getElementById('input-time_step_cont');

                if (inputCount + inputCount_p + inputCount_tcp >= 15) {
                alert('You can add a maximum of 5 set input fields.');
                return;
                }

                if (inputCount < 5) {
                    inputCount++;
                    let inputCct = document.createElement('input');
                    inputCct.className = 'input_Cp_step';
                    inputCct.id = `input_Cp_step${inputCount}`;
                    containerCct.appendChild(inputCct);
                }

                if (inputCount_p < 5) {
                let inputPlux = document.createElement('input');
                inputPlux.className = 'input_cP_step';
                inputPlux.id = 'input_cP_step' + (inputCount_p + 1);
                containerPlux.appendChild(inputPlux);
                inputCount_p++;
                }

                if (inputCount_tcp < 5) {
                let inputTime = document.createElement('input');
                inputTime.className = 'input_time_cp_step';
                inputTime.id = 'input_time_cp_step' + (inputCount_tcp + 1);
                containerTime.appendChild(inputTime);
                inputCount_tcp++;
                }
            }   
            
            // Display Current Time function 
            function updateDateTime() {
                const dateTimeElement = document.getElementById('dateTime');
                const now = new Date();
                const formattedDateTime = now.toLocaleString(); // Format the date and time
                
                dateTimeElement.textContent = formattedDateTime;
            }
            // Update the date and time initially
            updateDateTime();
            // Update the date and time every second
            setInterval(updateDateTime, 1000);

            // Select Pairwise Metrics
            metricsInput.addEventListener("change", function(){
                if(metricsInput.value == "0"){
                    
                    Stepbox.style.height = "400px";

                    // Display initial input field
                    selectCCT_PLUX.style.display = "block";
                    selectCCT_MEDI.style.display = "none";
                    selectPLUX_MEDI.style.display = "none";
                    selectMEDI_MDER.style.display = "none";

                    // Display button 
                    add_CP_step.style.display = "block";
                    set_CP_step.style.display = "block";

                }
                else if (metricsInput.value == "1"){
                    Stepbox.style.height = "420px";

                    // Display initial input field
                    selectCCT_PLUX.style.display = "none";
                    selectCCT_MEDI.style.display = "block";
                    selectPLUX_MEDI.style.display = "none";
                    selectMEDI_MDER.style.display = "none";

                }
                else if (metricsInput.value == "2"){
                    Stepbox.style.height = "420px";

                    // Display initial input field
                    selectCCT_PLUX.style.display = "none";
                    selectCCT_MEDI.style.display = "none";
                    selectPLUX_MEDI.style.display = "block";
                    selectMEDI_MDER.style.display = "none";

                }
                else if (metricsInput.value == "3"){
                    Stepbox.style.height = "420px";

                    // Display initial input field
                    selectCCT_PLUX.style.display = "none";
                    selectCCT_MEDI.style.display = "none";
                    selectPLUX_MEDI.style.display = "none";
                    selectMEDI_MDER.style.display = "block";

                }
                else if (metricsInput.value == "-1") {
                    Stepbox.style.height = "150px";

                    // Hide initial input field
                    selectCCT_PLUX.style.display = "none";
                    selectCCT_MEDI.style.display = "none";
                    selectPLUX_MEDI.style.display = "none";
                    selectMEDI_MDER.style.display = "none";

                    // Hide buttons
                    add_CP_step.style.display = "none";
                    set_CP_step.style.display = "none";

                }
            })

            // Event on click 
            // CCT & Plux 
            set_CP_step.addEventListener('click', async () => {
                //CCT
                console.log("Value of step_CCT1:", step_CCT1.value);

                var inputCCT_step2 = document.getElementById('input_Cp_step2');
                var step_CCT2 = inputCCT_step2.value;
                if (step_CCT2 === "") {
                    step_CCT2 = 0;
                }
                console.log('Value of step_CCT2: ' + step_CCT2);

                var inputCCT_step3 = document.getElementById('input_Cp_step3');
                var step_CCT3 = inputCCT_step3.value;
                if (step_CCT3 === "") {
                    step_CCT3 = 0;
                }
                console.log('Value of step_CCT3: ' + step_CCT3);

                var inputCCT_step4 = document.getElementById('input_Cp_step4');
                var step_CCT4 = inputCCT_step4.value;
                if (step_CCT4 === "") {
                    step_CCT4 = 0;
                }
                console.log('Value of step_CCT3: ' + step_CCT3);

                var inputCCT_step5 = document.getElementById('input_Cp_step5');
                var step_CCT5 = inputCCT_step5.value;
                if (step_CCT5 === "") {
                    step_CCT5 = 0;
                }
                console.log('Value of step_CCT3: ' + step_CCT5);

                // PLux
                console.log("Value of step_Plux1:", step_PLUX1.value);

                var inputPlux_step2 = document.getElementById('input_cP_step2');
                var step_PLUX2 = inputPlux_step2.value;
                if (step_PLUX2 == "") {
                   step_PLUX2 = 0;
                }
                console.log('Value of step_Plux2: ' + step_PLUX2);

                var inputPlux_step3 = document.getElementById('input_cP_step3');
                var step_PLUX3 = inputPlux_step3.value;
                if (step_PLUX3 == "") {
                   step_PLUX3 = 0;
                    
                }
                console.log('Value of step_Plux3: ' + step_PLUX3);

                var inputPlux_step4 = document.getElementById('input_cP_step4');
                var step_PLUX4 = inputPlux_step4.value;
                if (step_PLUX4 == "")
                    {
                        step_PLUX4 = 0;
                    }
                console.log('Value of step_Plux4: ' + step_PLUX4);
                

                var inputPlux_step5 = document.getElementById('input_cP_step5');
                var step_PLUX5 = inputPlux_step5.value;
                if (step_PLUX5 == "")
                    {
                        step_PLUX5 = 0;
                    }
                console.log('Value of step_Plux5: ' + step_PLUX5);
                
                // TIME
                console.log("Value of step_TIME1:", step_time_CP1.value);

                var inputTime_step2 = document.getElementById('input_time_cp_step2');
                var step_TIME2 = inputTime_step2.value;
                if (step_TIME2 == "")
                    {
                        step_TIME2 = 0;
                    }
                console.log('Value of step_TIME2: ' + step_TIME2);

                var inputTime_step3 = document.getElementById('input_time_cp_step3');
                var step_TIME3 = inputTime_step3.value;
                if (step_TIME3 == "")
                    {
                        step_TIME3 = 0;
                    }
                console.log('Value of step_TIME3: ' + step_TIME3);

                var inputTime_step4 = document.getElementById('input_time_cp_step4');
                var step_TIME4 = inputTime_step4.value;
                if (step_TIME4 == "")
                    {
                        step_TIME4 = 0;
                    }
                console.log('Value of step_TIME4: ' + step_TIME4);

                var inputTime_step5 = document.getElementById('input_time_cp_step5');
                var step_TIME5 = inputTime_step5.value;
                if (step_TIME5 == "")
                    {
                        step_TIME5 = 0;
                    }
                console.log('Value of step_TIME5: ' + step_TIME5);

                const requestData = {
                    allocatetime: allocate_Time.value,
                    initialcct: CCT_plux.value,
                    initialplux: cct_PLUX.value,
                    stepCCT1: step_CCT1.value,
                    stepCCT2: step_CCT2,
                    stepCCT3: step_CCT3,
                    stepCCT4: step_CCT4,
                    stepCCT5: step_CCT5,
                    stepPlux1: step_PLUX1.value,
                    stepPlux2: step_PLUX2,
                    stepPlux3: step_PLUX3,
                    stepPlux4: step_PLUX4,
                    stepPlux5: step_PLUX5,
                    steptime1: step_time_CP1.value,
                    steptime2: step_TIME2,
                    steptime3: step_TIME3,
                    steptime4: step_TIME4,
                    steptime5: step_TIME5
                };

                const response = await fetch('/get_step_CP', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                }); 
                const result = await response.json();     
                
                if (response.ok) {
                    const result = await response.json();
                    // Handle the response data here
                } else {
                    console.error('Request failed with status:', response.status);
                }
            })


        </script>
    </section> 
</body>
</html>

