<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set Light Spectrum</title>
    <!-- Link To CSS -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- Box Icons -->
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
</head>
<body>
    <!-- Header -->
    <header>
        <div class="nav container">
            <!-- Menu Icon -->
            <div class="bulb-icon">
                <i class='bx bx-bulb' id="bulb-icon"></i>
            </div>
            
            <!-- Logo -->
            <div class = "log">
                <ul>
                    <li><a class="logo">Intelligent Lighting Laboratory</a></li>
                </ul>
            </div>
        </div> 
    </header>
    <section id="ovrflw" class="backgrd">
        <div id="visual-metrics" class="VM">
            <h1> Visual Metrics</h1>
            <label for="vm_Input" class="input_select_text">Desired Metrics: </label>
            <select id="vm_Input" name="metricsInput" class="step_input_select">
                <option value="-1">None </option>
                <option value="0">CCT </option>
                <option value="1">Photopic Lux </option>
                <option value="2">CRI </option>
            </select><br>
            <div id="select_visual1" style="display: none;">
                <!-- CCT -->
                <label for="get_cct" class="input_select_text">Desired CCT: </label>
                <input type="text" name ="get_cct", id="get_cct", class="input-field-cct", placeholder="2500K ~ 6500K", min="2500", max="6000" > 
                <button id="set-button-cct" class="set-button-cct">Set</button>
            </div>
            <div id="select_visual2" style="display: none;">
                <!-- PLUX-->
                <label for="get_plux" class="input_select_text">Desired Plux: </label>
                <input type="text" name="get_plux", id="get_plux", class="input-field-plux", placeholder="0lx ~ 250lx",min="0", max="250" > 
                <button id="set-button-plux" class="set-button-plux">Set</button>     
            </div>
            <div id="select_visual3" style="display: none;">
                <!-- CRI -->
                <label for="get_cri" class="input_select_text">Desired CRI: </label>
                <input type = "text" name = "get_cri", id = "get_cri", class = "input-field-cri", placeholder="0 ~100", min="0", max="100"> 
                <button id="set-button-cri" class="set-button-cri">Set</button>    
            </div>
        </div>

        <div id="non-visual-metrics" class="NVM">
            <h1> Non-Visual Metrics</h1>
            <label for="nvm_Input" class="input_select_text">Desired Metrics: </label>
            <select id="nvm_Input" name="metricsInput" class="step_input_select">
                <option value="-1">None</option>
                <option value="0">MEDI & MDER </option>
            </select><br>
            <div id="select_non_visual1" style="display: none;">
                <!-- MEDI & MDER -->
                <label for="get_medi" class="input_select_text">Desired MEDI: </label>
                <input type="text" name="get_medi", id="get_medi", class="input-field-medi", placeholder="0lx ~ 200lx", min="0", max="250"><br>
                <label for="get_mder" class="input_select_text">Desired MDER: </label>
                <input type="text" name="get_mder", id="get_mder", class="input-field-mder", placeholder="0 ~ 1", min="0", max ="1" >   
                <button id="set-button-medi-mder" class="set-button-medi-mder">Set</button> 
            </div>
        </div>

        <div id="pairwise-metrics" class="PM">
            <h1> Pairwise Metrics</h1>
            <label for="pm_Input" class="input_select_text">Desired Metrics: </label>
            <select id="pm_Input" name="metricsInput" class="step_input_select">
                <option value="-1">None</option>
                <option value="0">CCT & Photopic Lux </option>
                <option value="1">CCT & MEDI </option>
                <option value="2">Photopic Lux & MEDI </option>
            </select><br>

             <!-- CCT & PLUX-->
            <div id="select_pair1" style="display: none;">
                <label for="get_cct" class="input_select_text">Desired CCT: </label>
                <input type="text" name = "get_cct_plux", id = "get_cct_plux", class = "input-field-cct-plux", placeholder="2500K ~ 6500K", min="2500", max="6500"><br>
                <label for="get_plux" class="input_select_text">Desired Plux: </label>
                <input type="text" name = "get_plux_cct", id = "get_plux_cct", class = "input-field-plux-cct", placeholder="0lx ~ 250lx", min="0", max="250">   
                <button id="set-button-cct-plux" class="set-button-cct-plux">Set</button> 
            </div>

            <div id="select_pair2" style="display: none;">
                <label for="get_cct" class="input_select_text">Desired CCT: </label>
                <input type="text" name = "get_cct_medi", id = "get_cct_medi", class = "input-field-cct-medi", placeholder="2500K ~ 6500K", min="2500", max="6500"><br>
                <label for="get_medi" class="input_select_text">Desired Medi: </label>
                <input type="text" name = "get_medi_cct", id = "get_medi_cct", class = "input-field-medi-cct", placeholder="0lx ~ 200lx", min="0", max ="200"> 
                <button id="set-button-cct-medi" class="set-button-cct-medi">Set</button> 
            </div>

            <div id="select_pair3" style="display: none;">
                <label for="get_plux" class="input_select_text">Desired Plux: </label>
                <input type="text" name = "get_plux_medi", id = "get_plux_medi", class = "input-field-plux-medi", placeholder="0lx ~ 250lx", min="0", max="250"><br>
                <label for="get_medi" class="input_select_text">Desired Medi: </label>
                <input type="text" name = "get_medi_plux", id = "get_medi_plux", class = "input-field-medi-plux", placeholder="0lx ~ 200lx", min="0", max ="200" >  
                <button id="set-button-plux-medi" class="set-button-plux-medi">Set</button> 
            </div>
        </div>
        

        
        <div class ="back">
            <a href="/metrics" class="back-btn"> Back </a> 
        </div>
        <div class ="cover">
            <h1>Illuminating Life Intelligently</h1>
            <p>We aim to fulfill all the choices and preferences of our customers.</p>
            <img src="/image/blue-hourglass.gif" alt="name" class="glasshour"/> 
            <img src="/image/logo.png" alt="uni_logo" class="uni_logo"/>    
        </div>
        <div class = "vl"></div>
        <div class ="clear">
            <button id="clearbutton" class="clearbutton">Clear Results</button>
        </div>
        
        <div class ="target-content">
            <h1>Target Metrics</h1>
            <p id="inputDisplay"> </p>
        </div>
        <div class = "close-loop">
            <h1> Close-Loop P Control:</h1>  
        </div>
        <label class="switch">
            <input id="toggle" type="checkbox">
            <span class="slider round"></span>
        </label>

        <div class = "result-content" >
            <h1>Measured Metrics Results:</h1>
            <div id="result-box" class="result-box"></div>
        </div>
        <div class= "plot" id='myDiv'></div>
        <div class = "energy-content" >
            <h1> Estimated Energy Usage </h1>
            <div id="result-box2" class="result-box2"> </div>
        </div>
        <div class = "occupancy" >
            <h1> Occupancy Status </h1>
            <div class = "result-box3">
                <div class="Presence"> Presence: </div>
                <div class="Detected"> Person Detected: </div>
            </div>
        </div>

        <script>
            // Button Constant
            const cctButton = document.getElementById('set-button-cct');
            const pluxButton = document.getElementById('set-button-plux');
            const criButton = document.getElementById('set-button-cri');
            const medi_mderButton = document.getElementById('set-button-medi-mder');
            const cct_pluxButton = document.getElementById('set-button-cct-plux');
            const cct_mediButton = document.getElementById('set-button-cct-medi');
            const plux_mediButton = document.getElementById('set-button-plux-medi');
            const clearButton = document.getElementById('clearbutton');
            const closeloopctrl = document.getElementById('toggle');

            // Input Constant of Visual metrics
            const inputCCT = document.getElementById('get_cct');
            const inputPlux = document.getElementById('get_plux');
            const inputCRI = document.getElementById('get_cri');

            // Input Constant of Non Visual metrics
            const inputMedi = document.getElementById('get_medi');
            const inputMder = document.getElementById('get_mder');

            // Input Constant of Pair metrics
            const inputCCT_cp = document.getElementById('get_cct_plux');
            const inputPlux_cp = document.getElementById('get_plux_cct');
            const inputCCT_cm = document.getElementById('get_cct_medi');
            const inputMedi_cm = document.getElementById('get_medi_cct');
            const inputPlux_pm = document.getElementById('get_plux_medi');
            const inputMedi_pm = document.getElementById('get_medi_plux');

            // Result Boxes Constant
            const dataResult = document.getElementById('result-box');
            const dataResult2 = document.getElementById('result-box2');
            
            // Display Constant
            const sliderInput = document.querySelector('.switch input');
            const glasshourGif = document.querySelector('.glasshour');
            const covering = document.querySelector('.cover');
            const close_loop = document.querySelector('.close-loop');
            const toggle_switch = document.querySelector('.switch');

            // Select visual List Constant 
            const visualbox = document.getElementById("visual-metrics");
            const visual_metricsInput = document.getElementById("vm_Input");
            const selectCCT = document.getElementById("select_visual1");
            const selectPlux = document.getElementById("select_visual2");
            const selectCRI = document.getElementById("select_visual3");

            // Select non-visual List Constant 
            const nonvisualbox = document.getElementById("non-visual-metrics");
            const non_visual_metricsInput = document.getElementById("nvm_Input");
            const selectMedi_Mder = document.getElementById("select_non_visual1");

            // Select pairwise List Constant 
            const pairbox = document.getElementById("pairwise-metrics");
            const pair_metricsInput = document.getElementById("pm_Input");
            const select_cctplux = document.getElementById("select_pair1");
            const select_cctmedi = document.getElementById("select_pair2");
            const select_pluxmedi = document.getElementById("select_pair3");
            
            // Create SPD plot
            function createPlot(yValues) {
            var SPM_return = {
                x: [380, 385, 390, 395, 400, 405, 410, 415, 420, 425, 430, 435, 440, 445, 450, 455, 
                460, 465, 470, 475, 480, 485, 490, 495, 500, 505, 510, 515, 520, 525, 530, 535, 540, 
                545, 550, 555, 560, 565, 570, 575, 580, 585, 590, 595, 600, 605, 610, 615, 620, 625, 
                630, 635, 640, 645, 650, 655, 660, 665, 670, 675, 680, 685, 690, 695, 700, 705, 710, 
                715, 720, 725, 730, 735, 740, 745, 750, 755, 760, 765, 770, 775, 780],
                y: yValues,
                type: 'scatter',
                fill: 'tozeroy',
                fillcolor: 'lightblue',
            };

            var data = [SPM_return];
            var layout = {
                height: 450,
                width: 550,
                margin: {
                t: 50,  // Top margin
                b: 60,  // Bottom margin
                l: 50,  // Left margin
                r: 20   // Right margin
                },
                title: {text: 'Plot of SPD', 
                font: {
                    size: 23, 
                    weight: 'bolder'
                }
                },
                xaxis: {
                title: 'Wavelength (nm)',
                titlefont: {size: 12},
                tickfont: { size: 10}
                },
                yaxis: {
                title: 'Spectral Power Density (mW/m^2/nm)',
                titlefont: {size: 12},
                tickfont: { size: 10}
                }
            };

            Plotly.newPlot('myDiv', data, layout);
            }
        
            // Assuming you have a function to update the results on the HTML page
            function updateResults_v(results, buttonClicked) {
            const cctColor = buttonClicked === 'cct' ? 'rgba(11, 73, 241, 0.615); font-weight: bold;' : 'white';
            const pluxColor = buttonClicked === 'plux' ? 'rgba(11, 73, 241, 0.615); font-weight: bold;' : 'white';
            const criColor = buttonClicked === 'cri' ? 'rgba(11, 73, 241, 0.615); font-weight: bold ' : 'white';
            
            dataResult.innerHTML = `
                <p> CCT: <span style="color: ${cctColor}"> ${results['Measured CCT']} K</span></p>
                <p> Plux: <span style="color: ${pluxColor}">${results['Measured plux']} lux</span></p>
                <p> CRI: <span style="color: ${criColor}"> ${results['Measured CRI']}</span></p> 
                <p> MEDI: ${results['Measured medi']} lux</p>
                <p> MDER: ${results['Measured mder']}</p>
            `;

            dataResult2.innerHTML = `
                <p> LER: ${results['Measured LER']} lm/W</p>
                <p> Lumen: ${results['Measured Lumen']} lm</p>
                <p> Watt: ${results['Measured Watt']} W <p>
            `;

            createPlot(results['SPM_interpolated']);

            }

            function updateResults_nv(results, buttonClicked) {
            const medi_mderColor = buttonClicked === 'medi_mder' ? 'rgba(11, 73, 241, 0.615); font-weight: bold;' : 'white';
           
            dataResult.innerHTML = `
                <p> CCT: ${results['Measured CCT']} K</p>
                <p> Plux: ${results['Measured plux']} lux</p>
                <p> CRI: ${results['Measured CRI']}</p> 
                <p> MEDI: <span style="color: ${medi_mderColor}"> ${results['Measured medi']} lux </span></p>
                <p> MDER: <span style="color: ${medi_mderColor}"> ${results['Measured mder']} </span></p>
            `;

            dataResult2.innerHTML = `
                <p> LER: ${results['Measured LER']} lm/W</p>
                <p> Lumen: ${results['Measured Lumen']} lm</p>
                <p> Watt: ${results['Measured Watt']} W <p>
            `;

            createPlot(results['SPM_interpolated']);

            }

            function updateResults_p(results, buttonClicked) {
            const cctColor = (buttonClicked === 'cct_plux' || buttonClicked === 'cct_medi') ? 'rgba(11, 73, 241, 0.615); font-weight: bold;' : 'white';
            const mediColor = (buttonClicked === 'cct_medi' || buttonClicked === 'plux_medi') ? 'rgba(11, 73, 241, 0.615); font-weight: bold;' : 'white';
            const pluxColor = (buttonClicked === 'plux_medi' || buttonClicked === 'cct_plux') ? 'rgba(11, 73, 241, 0.615); font-weight: bold ' : 'white';

            dataResult.innerHTML = `
                <p> CCT: <span style="color: ${cctColor}"> ${results['Measured CCT']} K </span></p>
                <p> Plux: <span style="color: ${pluxColor}"> ${results['Measured plux']} lux </span></p>
                <p> CRI: ${results['Measured CRI']}</p> 
                <p> MEDI: <span style="color: ${mediColor}"> ${results['Measured medi']} lux </span></p>
                <p> MDER: ${results['Measured mder']}</p>
            `;

            dataResult2.innerHTML = `
                <p> LER: ${results['Measured LER']} lm/W</p>
                <p> Lumen: ${results['Measured Lumen']} lm</p>
                <p> Watt: ${results['Measured Watt']} W <p>
            `;

            createPlot(results['SPM_interpolated']);

            }


            // Display Target metrics
            function cctInputDisplay(cct) {
                const inputDisplay = document.getElementById('inputDisplay');
                inputDisplay.innerHTML = `Target CCT: <span style="color: rgba(11, 73, 241, 0.615); font-weight: bold;"> ${cct} K </span>`;
            }

            function pluxInputDisplay(plux) {
                const inputDisplay = document.getElementById('inputDisplay');
                inputDisplay.innerHTML = `Target Plux: <span style="color: rgba(11, 73, 241, 0.615); font-weight: bold;"> ${plux} lux </span>`;
            }

            function criInputDisplay(cri) {
                const inputDisplay = document.getElementById('inputDisplay');
                inputDisplay.innerHTML = `Target CRI: <span style="color: rgba(11, 73, 241, 0.615); font-weight: bold;"> ${cri} </span>`;
            }

            function medi_mderInputDisplay(medi, mder) {
                const inputDisplay = document.getElementById('inputDisplay');
                inputDisplay.innerHTML = `
                <p>Target MEDI: <span style="color: rgba(11, 73, 241, 0.615); font-weight: bold;"> ${medi} lux  </span></p>
                <p>Target MDER: <span style="color: rgba(11, 73, 241, 0.615); font-weight: bold;"> ${mder} </span></p>
                `;
            }

            function cct_pluxInputDisplay(cct, plux) {
                const inputDisplay = document.getElementById('inputDisplay');
                inputDisplay.innerHTML = `
                <p> Target CCT: <span style="color: rgba(11, 73, 241, 0.615); font-weight: bold;"> ${cct} K </span></p> 
                <p> Target Plux: <span style="color: rgba(11, 73, 241, 0.615); font-weight: bold;"> ${plux} lux </span></p>  
                `;
            }

            function cct_mediInputDisplay(cct, medi) {
                const inputDisplay = document.getElementById('inputDisplay');
                inputDisplay.innerHTML = `
                <p> Target CCT: <span style="color: rgba(11, 73, 241, 0.615); font-weight: bold;"> ${cct} K </span>
                <p> Target Medi: <span style="color: rgba(11, 73, 241, 0.615); font-weight: bold;"> ${medi} lux </span></p>
                `;
            }

            function plux_mediInputDisplay(plux, medi) {
                const inputDisplay = document.getElementById('inputDisplay');
                inputDisplay.innerHTML = `
                <p> Target Plux: <span style="color: rgba(11, 73, 241, 0.615); font-weight: bold;"> ${plux} lux </span></p>
                <p> Target Medi: <span style="color: rgba(11, 73, 241, 0.615); font-weight: bold;"> ${medi} lux </span></p>
                `;
            }
            
            // Clear Button
            clearButton.addEventListener('click', async () => {
                sliderInput.checked = false;
                glasshourGif.style.display = 'none';
                covering.style.display = 'flex';
                close_loop.style.display = 'none';
                toggle_switch.style.display = 'none';
                inputCCT.value = '';
                inputPlux.value = '';
                inputCRI.value = '';
                inputMedi.value = '';
                inputMder.value = '';
                inputCCT_cp.value = ''; 
                inputPlux_cp.value = '';
                inputCCT_cm.value = '';
                inputMedi_cm.value = '';
                inputPlux_pm.value = '';
                inputMedi_pm.value = '';
            });

            // Display metric's style on change
            visual_metricsInput.addEventListener("change", function(){
                if(visual_metricsInput.value == "-1"){    
                    visualbox.style.height = "90px";
                    selectCCT.style.display = "none";
                    selectPlux.style.display = "none";
                    selectCRI.style.display = "none";
                }
                else if(visual_metricsInput.value == "0"){
                    visualbox.style.height = "140px";
                    selectCCT.style.display = "block";
                    selectPlux.style.display = "none";
                    selectCRI.style.display = "none";
                }
                else if(visual_metricsInput.value == "1"){
                    visualbox.style.height = "140px";
                    selectCCT.style.display = "none";
                    selectPlux.style.display = "block";
                    selectCRI.style.display = "none";
                }
                else if(visual_metricsInput.value == "2"){
                    visualbox.style.height = "140px";
                    selectCCT.style.display = "none";
                    selectPlux.style.display = "none";
                    selectCRI.style.display = "block";
                }
            });

            non_visual_metricsInput.addEventListener("change", function(){
                if(non_visual_metricsInput.value == "-1"){
                    pairbox.style.top = "57.5%";
                    nonvisualbox.style.height = "90px";
                    selectMedi_Mder.style.display = "none";
                }
                else if(non_visual_metricsInput.value == "0"){
                    pairbox.style.top = "67.5%";
                    nonvisualbox.style.height = "210px";
                    selectMedi_Mder.style.display = "block";
                }
            })

            pair_metricsInput.addEventListener("change", function(){
                if(pair_metricsInput.value == "-1"){
                    pairbox.style.height = "90px";
                    select_cctplux.style.display = "none";
                    select_cctmedi.style.display = "none";
                    select_pluxmedi.style.display = "none";
                }
                else if(pair_metricsInput.value == "0"){
                    pairbox.style.height = "210px";
                    select_cctplux.style.display = "block";
                    select_cctmedi.style.display = "none";
                    select_pluxmedi.style.display = "none";
                }
                else if(pair_metricsInput.value == "1"){
                    pairbox.style.height = "210px";
                    select_cctplux.style.display = "none";
                    select_cctmedi.style.display = "block";
                    select_pluxmedi.style.display = "none";
                }
                else if(pair_metricsInput.value == "2"){
                    pairbox.style.height = "210px";
                    select_cctplux.style.display = "none";
                    select_cctmedi.style.display = "none";
                    select_pluxmedi.style.display = "block";
                }
            })

            
            // Event on click 
            // CCT 
            cctButton.addEventListener('click', async () => {
              glasshourGif.style.display = 'block';
              const response = await fetch('/getCCT_OL', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({ data: inputCCT.value })
              });
              cctInputDisplay(inputCCT.value);
              const result = await response.json();
              updateResults_v(result.processedData, 'cct');  
              covering.style.display = 'none';
              close_loop.style.display = 'block';
              toggle_switch.style.display = 'block';
            });

            // Plux
            pluxButton.addEventListener('click', async () => {
                glasshourGif.style.display = 'block';
                const response = await fetch('/getPlux_OL', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({ data: inputPlux.value })
              });
              pluxInputDisplay(inputPlux.value);
              const result = await response.json();
              updateResults_v(result.processedData, 'plux');
              covering.style.display = 'none'; 
              close_loop.style.display = 'block';
              toggle_switch.style.display = 'block';
            });

            // CRI
            criButton.addEventListener('click', async () => {
                glasshourGif.style.display = 'block';
                const response = await fetch('/getCRI', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({ data: inputCRI.value })
              });
              criInputDisplay(inputCRI.value);
              const result = await response.json();
              updateResults_v(result.processedData, 'cri'); 
              covering.style.display = 'none';
              close_loop.style.display = 'block';
              toggle_switch.style.display = 'block'; 
            });

            // Medi Mder
            medi_mderButton.addEventListener('click', async () => {
                glasshourGif.style.display = 'block';
                const requestData = {
                    inputmedi: inputMedi.value,
                    inputmder: inputMder.value
                };

                const response = await fetch('/getMEDI_MDER_OL', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
              });
              medi_mderInputDisplay(inputMedi.value, inputMder.value)
              const result = await response.json();
              updateResults_nv(result.processedData, 'medi_mder');  
              covering.style.display = 'none';
              close_loop.style.display = 'block';
              toggle_switch.style.display = 'block';
            });

            // CCT Plux
            cct_pluxButton.addEventListener('click', async () => {
                glasshourGif.style.display = 'block';
                const requestData = {
                    inputcct: inputCCT_cp.value,
                    inputplux: inputPlux_cp.value
                };

                const response = await fetch('/get_CCT_Plux_OL', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
              });
              cct_pluxInputDisplay(inputCCT_cp.value, inputPlux_cp.value)
              const result = await response.json();
              updateResults_p(result.processedData, 'cct_plux'); 
              covering.style.display = 'none';
              close_loop.style.display = 'block';
              toggle_switch.style.display = 'block';
            });

            // CCT Medi
            cct_mediButton.addEventListener('click', async () => {
                glasshourGif.style.display = 'block';
                const requestData = {
                    inputcct: inputCCT_cm.value,
                    inputmedi: inputMedi_cm.value
                };
                
                const response = await fetch('/get_CCT_MEDI_OL', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
              });
              cct_mediInputDisplay(inputCCT_cm.value, inputMedi_cm.value)
              const result = await response.json();
              updateResults_p(result.processedData, 'cct_medi'); 
              covering.style.display = 'none';
              close_loop.style.display = 'block';
              toggle_switch.style.display = 'block';
            });

            // Plux Medi
            plux_mediButton.addEventListener('click', async () => {
                glasshourGif.style.display = 'block';
                const requestData = {
                    inputplux: inputPlux_pm.value,
                    inputmedi: inputMedi_pm.value
                };

                const response = await fetch('/get_Plux_MEDI_OL', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
              });
              plux_mediInputDisplay(inputPlux_pm.value, inputMedi_pm.value)
              const result = await response.json();
              updateResults_p(result.processedData, 'plux_medi');  
              covering.style.display = 'none';
              close_loop.style.display = 'block';
              toggle_switch.style.display = 'block';
            });
            
            // On toggle Close Loop Control
            closeloopctrl.addEventListener('click', async () =>{
                if(inputCCT.value !== ""){
                    covering.style.display = 'flex';
                    glasshourGif.style.display = 'block';
                    const response = await fetch('/getCCT_CL', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ data: inputCCT.value })
                    });
                    cctInputDisplay(inputCCT.value);
                    const result = await response.json();
                    updateResults_v(result.processedData, 'cct');  
                    covering.style.display = 'none';

                } else if(inputPlux.value !== ""){
                    covering.style.display = 'flex';
                    glasshourGif.style.display = 'block';
                    const response = await fetch('/getPlux_CL', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ data: inputPlux.value })
                    });
                    pluxInputDisplay(inputPlux.value);
                    const result = await response.json();
                    updateResults_v(result.processedData, 'plux');
                    covering.style.display = 'none';

                } else if(inputCRI.value !== ""){
                    covering.style.display = 'flex';
                    glasshourGif.style.display = 'block';
                    const response = await fetch('/getCRI_CL', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ data: inputCRI.value })
                    });
                    criInputDisplay(inputCRI.value);
                    const result = await response.json();
                    updateResults_v(result.processedData, 'cri'); 
                    covering.style.display = 'none';

                }  else if(inputMedi.value != "" && inputMder.value != ""){
                    covering.style.display = 'flex';
                    glasshourGif.style.display = 'block';

                    const requestData = {
                        inputmedi: inputMedi.value,
                        inputmder: inputMder.value
                    };

                    const response = await fetch('/getMEDI_MDER_CL', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                    });
                    medi_mderInputDisplay(inputMedi.value, inputMder.value)
                    const result = await response.json();
                    updateResults_nv(result.processedData, 'medi_mder');  
                    covering.style.display = 'none';
            
                } else if(inputCCT_cp.value !== "" && inputPlux_cp.value !== ""){
                    covering.style.display = 'flex';
                    glasshourGif.style.display = 'block';
                    const requestData = {
                        inputcct: inputCCT_cp.value,
                        inputplux: inputPlux_cp.value
                    };
                    const response = await fetch('/get_CCT_Plux_CL', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                    });
                    cct_pluxInputDisplay(inputCCT_cp.value, inputPlux_cp.value)
                    const result = await response.json();
                    updateResults_p(result.processedData, 'cct_plux'); 
                    covering.style.display = 'none';

                } else if(inputCCT_cm.value !== "" && inputMedi_cm !== ""){
                    covering.style.display = 'flex';
                    glasshourGif.style.display = 'block';
                    const requestData = {
                        inputcct: inputCCT_cm.value,
                        inputmedi: inputMedi_cm.value
                    };
                    
                    const response = await fetch('/get_CCT_MEDI_CL', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                    });
                    cct_mediInputDisplay(inputCCT_cm.value, inputMedi_cm.value)
                    const result = await response.json();
                    updateResults_p(result.processedData, 'cct_medi'); 
                    covering.style.display = 'none';

                } else if(inputPlux_pm.value !== "" && inputMedi_pm.value !== ""){
                    covering.style.display = 'flex';
                    glasshourGif.style.display = 'block';
                    const requestData = {
                        inputplux: inputPlux_pm.value,
                        inputmedi: inputMedi_pm.value
                    };

                    const response = await fetch('/get_Plux_MEDI_CL', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                    });
                    plux_mediInputDisplay(inputPlux_pm.value, inputMedi_pm.value)
                    const result = await response.json();
                    updateResults_p(result.processedData, 'plux_medi');  
                    covering.style.display = 'none';
                    } 
            })
                
        </script>

    </section>
    <!-- Link To JS -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src='https://cdn.plot.ly/plotly-2.25.2.min.js'></script>
</body>
</html>