<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set Light Spectrum</title>
    <!-- Link To CSS -->
    <link rel="stylesheet" href="/css/style_ja.css">
    <!-- Box Icons -->
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
</head>
<body>
    <!-- Header -->
    <header>
        <div class="nav container">
            <!-- Menu Icon -->
            <div class="bulb-icon">
                <i class='bx bx-bulb' id="bulb-icon"></i>
            </div>
            
            <!-- Logo -->
            <div class = "log">
                <ul>
                    <li><a class="logo">Intelligent Lighting Laboratory</a></li>
                </ul>
            </div>
        </div> 
    </header>
    <section id="ovrflw" class="backgrd">
        <div class = "vm">
            <h1> -> Integrative Light Simulator with Indoor Daylight Prediction <- </h1>
        </div>

        <div class = "ja_time">
            <h1 id="dateTime"></h1>
        </div>
        
        <div class = "ja_input_box">
            <h1>Daylight Prediction</h1>
            <label for="curtainInput" class="ja_input_select_text">Curtain opened percentage: </label>
            <select id="curtainInput" name="curtainInput" class="ja_input_select">
                <option value="0">0%</option>
                <option value="10">10%</option>
                <option value="25">25%</option>
                <option value="50">50%</option>
                <option value="75">75%</option>
                <option value="90">90%</option>
                <option value="100">100%</option>
            </select><br>

            <button id="openPopup" class="ja_input_button">Select target zone</button>
            <!-- <span class="ja_text" id="selectedZone" style="display: none;"></span> -->
            <div class="popup" id="popup">
                <div class="popup-content">
                <!-- Create a 6x4 matrix of buttons -->
                <!-- You can replace the text with your own content -->
                <button class="popup-button">Zone 1</button>
                <button class="popup-button">Zone 2</button>
                <button class="popup-button">Zone 3</button>
                <button class="popup-button">Zone 4</button>
                <button class="popup-button">Zone 5</button>
                <button class="popup-button">Zone 6</button>
                <button class="popup-button">Zone 7</button>
                <button class="popup-button">Zone 8</button>
                <button class="popup-button">Zone 9</button>
                <button class="popup-button">Zone 10</button>
                <button class="popup-button">Zone 11</button>
                <button class="popup-button">Zone 12</button>
                <button class="popup-button">Zone 13</button>
                <button class="popup-button">Zone 14</button>
                <button class="popup-button">Zone 15</button>
                <button class="popup-button">Zone 16</button>
                <button class="popup-button">Zone 17</button>
                <button class="popup-button">Zone 18</button>
                <button class="popup-button">Zone 19</button>
                <button class="popup-button">Zone 20</button>
                <button class="popup-button">Zone 21</button>
                <button class="popup-button">Zone 22</button>
                <button class="popup-button">Zone 23</button>
                <button class="popup-button">Zone 24</button>
                </div>
            </div>

            <br><button id="ja_predict" class="ja_input_button">Predict</button>
        </div>

        <div class= "plot" id='myDiv'></div>

        <div class = "ja_input_box2">
            <h1>Set Your Desired Metrics</h1>
            <!-- <p>(Suggested range: 2500K - 6500K)</p> -->
            
            <label for="metricsInput" class="ja_input_select_text">Desired pair metrics: </label>
            <select id="metricsInput" name="metricsInput" class="ja_input_select">
                <option value="-1">None</option>
                <option value="0">CCT & Photopic Lux</option>
                <option value="1">CCT & MEDI</option>
            </select><br>
            <div id="ja_selected_pair1" style="display: none;">
                <label for="ja_get_cct" class="ja_input_select_text">Desired CCT: </label>
                <input type="text" name ="ja_get_cct", id="ja_get_cct", class="ja_input_text", placeholder="2000K ~ 6500K", min="2000", max="6500" ><br>
                <label for="ja_get_plux" class="ja_input_select_text">Desired Plux: </label>
                <input type="text" name ="ja_get_plux", id="ja_get_plux", class="ja_input_text", placeholder="0lx ~ 250lx", min="0", max="250" ><br>
            </div>
            <div id="ja_selected_pair2" style="display: none;">
                <label for="ja_get_cct2" class="ja_input_select_text">Desired CCT: </label>
                <input type="text" name ="ja_get_cct2", id="ja_get_cct2", class="ja_input_text", placeholder="2000K ~ 6500K", min="2000", max="6500" ><br>
                <label for="ja_get_medi" class="ja_input_select_text">Desired MEDI: </label>
                <input type="text" name ="ja_get_medi", id="ja_get_medi", class="ja_input_text", placeholder="0lx ~ 200lx", min="0", max="200" ><br>
            </div>
            
            <br><button id="ja_input_set" class="ja_input_button">Set</button>
        </div>

        
        
        <div class ="back">
            <a href="/" class="back-btn"> Home </a> 
        </div>
        
        <!-- <div class ="target-content">
            <h1>Target Metrics</h1>
            <p id="inputDisplay"> </p>
        </div>

        <div class = "result-content" >
            <h1>Measured Metrics Results:</h1>
            <div id="result-box" class="result-box"></div>
        </div> -->
        <!-- <div class = "energy-content" >
            <h1> Estimated Energy Usage </h1>
            <div id="result-box2" class="result-box2"> </div>
        </div> -->
        <!-- <div class = "occupancy" >
            <h1> Occupancy Status </h1>
            <div class = "result-box3">
                <div class="Presence"> Presence: </div>
                <div class="Detected"> Person Detected: </div>
            </div>
        </div> -->

        <script>
            const setButton = document.getElementById("ja_input_set");
            const curtainInput = document.getElementById("curtainInput");
            const metricsInput = document.getElementById("metricsInput");
            const cctInput1 = document.getElementById("ja_get_cct");
            const pluxInput = document.getElementById("ja_get_plux");
            const cctInput2 = document.getElementById("ja_get_cct2");
            const mediInput = document.getElementById("ja_get_medi");
            const predictButton = document.getElementById("ja_predict");
            let zonesSelection = 0;



            function updateDateTime() {
                const dateTimeElement = document.getElementById('dateTime');
                const now = new Date();
                const formattedDateTime = now.toLocaleString(); // Format the date and time
                
                dateTimeElement.textContent = formattedDateTime;
            }
            // Update the date and time initially
            updateDateTime();
            // Update the date and time every second
            setInterval(updateDateTime, 1000);

            // popup button
            const openPopupButton = document.getElementById("openPopup");
            const popup = document.getElementById("popup");
            const selectedZone = document.getElementById("selectedZone");
            openPopupButton.addEventListener("click", () => {
            popup.style.display = "flex";
            });
            // Add event listeners to each popup button
            const popupButtons = document.querySelectorAll(".popup-button");
            popupButtons.forEach(button => {
            button.addEventListener("click", () => {
                openPopupButton.innerText = "Selected target zone: " + button.innerText;
                //selectedZone.style.display = "block";
                popup.style.display = "none";
                zonesSelection = 1
            });
            });

            // pair metrics
            const selectedPair1Div = document.getElementById("ja_selected_pair1");
            const selectedPair2Div = document.getElementById("ja_selected_pair2");
            metricsInput.addEventListener("change", function () {
                if (metricsInput.value === "0") {
                    selectedPair1Div.style.display = "block";
                    selectedPair2Div.style.display = "none";
                } else if (metricsInput.value === "1") {
                    selectedPair1Div.style.display = "none";
                    selectedPair2Div.style.display = "block";
                } else {
                    selectedPair1Div.style.display = "none";
                    selectedPair2Div.style.display = "none";
                }
            });

            // For the Set button
            setButton.addEventListener("click", function () {
                let valid = true;
                const errorMessage = "Please select or fill in all required fields.";
          
                if (curtainInput.value === "-1") {
                  valid = false;
                  alert(errorMessage);
                } else if (metricsInput.value === "-1") {
                  valid = false;
                  alert(errorMessage);
                } else if (metricsInput.value === "0" && (cctInput1.value === "" || pluxInput.value === "")) {
                  valid = false;
                  alert(errorMessage);
                } else if (metricsInput.value === "1" && (cctInput2.value === "" || mediInput.value === "")) {
                  valid = false;
                  alert(errorMessage);
                } else if (zonesSelection === 0) {
                    valid = false;
                    alert(errorMessage);
                  }
          
                if (valid) {
                  // Proceed with your action here
                  alert("Inputs are valid. Performing action...");
                }
            });

            // For Predict button
            predictButton.addEventListener('click', async () => {
                const response = await fetch('/predict', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({ data: curtainInput.value })
                });
                const result = await response.json();
                console.log(result.processedData)
            });


        </script>

    </section>
    <!-- Link To JS -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src='https://cdn.plot.ly/plotly-2.25.2.min.js'></script>
</body>
</html>